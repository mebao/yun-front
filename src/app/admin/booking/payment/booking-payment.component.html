<!-- <header-nav></header-nav> -->
<div class="content-section admin-booking-payment">
	<top-bar [data]="topBar"></top-bar>
	<div nz-row [nzGutter]="30">
		<div nz-col [nzSpan]="6">
            <nz-card class="w100">
                <ng-template #title>
                    预约详情
                </ng-template>
                <ng-template #body>
					<div>姓名：{{bookingInfo.childName}}</div>
					<div class="mt10">年龄：{{bookingInfo.age}}</div>
					<div class="mt10">家长：{{bookingInfo.creatorName}}</div>
					<div class="mt10 flex">
						<div>会员：</div>
						<div class="flex-1">{{userInfo.member.member ? userInfo.member.name : '非会员'}}</div>
					</div>
					<div class="mt10">余额：{{userInfo.member.userBalance}}</div>
				</ng-template>
			</nz-card>
		</div>
		<div nz-col [nzSpan]="18">
            <nz-card class="w100">
                <ng-template #title>
                    费用详情
                </ng-template>
                <ng-template #body>
					<div *ngIf="pageType == '1'" class="mt10">
						暂无费用信息
					</div>
					<div *ngIf="pageType == ''">
						<div class="flex" *ngIf="bookingInfo.status == '5'">
							<div class="flex-1"></div>
							<div class="flex-0"><button (click)="print()" target="_blank" nz-button [nzType]="'primary'" [nzSize]="'large'">打印</button></div>
						</div>
						<div *ngIf="bookingInfo.status != '5' && paymentType == '30' && dataCode == '1'" class="mt20 text-right">
							<button *ngIf="editMemberType != 'update'" (click)="updateMember()" nz-button [nzType]="'primary'" [nzSize]="'large'">修改折扣</button>
							<button *ngIf="editMemberType == 'update'" (click)="cancelMember()" nz-button [nzType]="'default'" [nzSize]="'large'">取消</button>
							<button *ngIf="editMemberType == 'update'" (click)="saveMember()" nz-button [nzType]="'primary'" [nzSize]="'large'">保存</button>
						</div>
						<div *ngIf="fee.feeInfo.serviceFeeList.length > 0" class="section">
							<div class="title">医生科室费用</div>
							<div class="pad10">
								<nz-table #nzTable [nzDataSource]="fee.feeInfo.serviceFeeList" [nzBordered]="true" [nzIsPagination]="false">
									<thead nz-thead nz-thead>
										<tr>
											<th>科室</th>
											<th>总价</th>
											<th class="width-lg">备注</th>
											<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
												<th>折扣</th>
												<th>折后金额</th>
											</ng-container>
											<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
												<th>金额</th>
											</ng-container>
										</tr>
									</thead>
									<tbody nz-tbody>
										<tr nz-tbody-tr *ngFor="let service of fee.feeInfo.serviceFeeList; let index=index;">
											<td>{{service.serviceName}}</td>
											<td>{{service.originalFee + (service.hasActcardPay ? '（活动卡价格）' : '')}}</td>
											<td>
												<div class="text-lg">{{service.remark}}</div>
											</td>
											<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
												<td>
													<span *ngIf="editMemberType != 'update'">{{service.serviceDiscount}}%</span>
													<div *ngIf="editMemberType == 'update'" class="flex">
														<nz-input-number [nzMin]="0" [nzMax]="100" [nzStep]="1" [(ngModel)]="service.serviceDiscount"
														(nzBlur)="changeDiscount(service.serviceDiscount, service.serviceName)"></nz-input-number>
														<div class="pt5">%</div>
													</div>
												</td>
												<td>{{service.serviceFee}}</td>
											</ng-container>
											<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
												<td>{{service.serviceFee}}</td>
											</ng-container>
										</tr>
										<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
											<tr nz-tbody-tr>
												<td colspan="5">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.serviceOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<tr nz-tbody-tr>
												<td colspan="5">
													<div class="flex">
														<div class="flex-1 text-right">折扣金额：</div>
														<div class="w100p">{{fee.feeInfo.serviceDiscount}}</div>
													</div>
												</td>
											</tr>
											<tr nz-tbody-tr>
												<td colspan="5">
													<div class="flex">
														<div class="flex-1 text-right">已付预约费用：</div>
														<div class="w100p">{{fee.feeInfo.bookingFee}}</div>
													</div>
												</td>
											</tr>
											<tr nz-tbody-tr>
												<td colspan="5">
													<div class="flex">
														<div class="flex-1 text-right">应收费用：</div>
														<div class="w100p">{{fee.feeInfo.serviceFee}}</div>
													</div>
												</td>
											</tr>
										</ng-container>
										<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
											<tr nz-tbody-tr>
												<td colspan="4">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.serviceOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<tr nz-tbody-tr>
												<td colspan="4">
													<div class="flex">
														<div class="flex-1 text-right">已付费用：</div>
														<div class="w100p">{{fee.feeInfo.bookingFee}}</div>
													</div>
												</td>
											</tr>
											<tr nz-tbody-tr>
												<td colspan="4">
													<div class="flex">
														<div class="flex-1 text-right">应收费用：</div>
														<div class="w100p">{{fee.feeInfo.serviceFee}}</div>
													</div>
												</td>
											</tr>
										</ng-container>
										<ng-container *ngIf="dataCode == '0'">
											<tr nz-tbody-tr>
												<td colspan="3">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.serviceOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<tr nz-tbody-tr>
												<td colspan="3">
													<div class="flex">
														<div class="flex-1 text-right">折扣金额：</div>
														<div class="w100p">{{fee.feeInfo.serviceDiscount}}</div>
													</div>
												</td>
											</tr>
											<tr nz-tbody-tr>
												<td colspan="3">
													<div class="flex">
														<div class="flex-1 text-right">已付预约费用：</div>
														<div class="w100p">{{fee.feeInfo.bookingFee}}</div>
													</div>
												</td>
											</tr>
											<tr nz-tbody-tr>
												<td colspan="3">
													<div class="flex">
														<div class="flex-1 text-right">应收费用：</div>
														<div class="w100p">{{fee.feeInfo.serviceFee}}</div>
													</div>
												</td>
											</tr>
										</ng-container>
									</tbody>
								</nz-table>
							</div>
						</div>
						<div *ngIf="fee.feeInfo.assistFeeList.length > 0" class="section">
							<div class="title">辅助治疗费用</div>
							<div class="pad10">
								<nz-table #nzTable [nzDataSource]="fee.feeInfo.assistFeeList" [nzBordered]="true" [nzIsPagination]="false">
									<thead nz-thead>
										<tr>
											<th>辅助治疗</th>
											<th>单价</th>
											<th>数量</th>
											<th>总价</th>
											<th class="width-lg">备注</th>
											<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
												<th>折扣</th>
												<th>折后金额</th>
											</ng-container>
											<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
												<th>金额</th>
											</ng-container>
										</tr>
									</thead>
									<tbody nz-tbody>
										<tr nz-tbody-tr *ngFor="let assist of fee.feeInfo.assistFeeList; let index=index;">
											<td>{{assist.projectName}}</td>
											<td>{{assist.price}}</td>
											<td>{{assist.number}}</td>
											<td>{{assist.originalFee}}</td>
											<td>
												<div class="text-lg">{{assist.remark}}</div>
											</td>
											<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
												<td>
													<span *ngIf="editMemberType != 'update'">{{assist.assistDiscount}}%</span>
													<div *ngIf="editMemberType == 'update'" class="flex">
														<nz-input-number [nzMin]="0" [nzMax]="100" [nzStep]="1" [(ngModel)]="assist.assistDiscount"
														(nzBlur)="changeDiscount(assist.assistDiscount, assist.projectName)"></nz-input-number>
														<div class="pt5">%</div>
													</div>
												</td>
												<td>{{assist.assistFee}}</td>
											</ng-container>
											<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
												<td>{{assist.assistFee}}</td>
											</ng-container>
										</tr>
										<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
											<tr nz-tbody-tr>
												<td colspan="7">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.assistOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<ng-container *ngIf="fee.feeInfo.assistOriginalFee != fee.feeInfo.assistDiscount">
												<tr nz-tbody-tr>
													<td colspan="7">
														<div class="flex">
															<div class="flex-1 text-right">折扣金额：</div>
															<div class="w100p">{{fee.feeInfo.assistDiscount}}</div>
														</div>
													</td>
												</tr>
												<tr nz-tbody-tr>
													<td colspan="7">
														<div class="flex">
															<div class="flex-1 text-right">应收费用：</div>
															<div class="w100p">{{fee.feeInfo.assistFee}}</div>
														</div>
													</td>
												</tr>
											</ng-container>
										</ng-container>
										<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
											<tr nz-tbody-tr>
												<td colspan="6">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.assistOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<ng-container *ngIf="fee.feeInfo.assistOriginalFee != fee.feeInfo.assistDiscount">
												<tr nz-tbody-tr>
													<td colspan="6">
														<div class="flex">
															<div class="flex-1 text-right">应收费用：</div>
															<div class="w100p">{{fee.feeInfo.assistFee}}</div>
														</div>
													</td>
												</tr>
											</ng-container>
										</ng-container>
										<ng-container *ngIf="dataCode == '0'">
											<tr nz-tbody-tr>
												<td colspan="5">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.assistOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<ng-container *ngIf="fee.feeInfo.assistOriginalFee != fee.feeInfo.assistDiscount">
												<tr nz-tbody-tr>
													<td colspan="5">
														<div class="flex">
															<div class="flex-1 text-right">折扣金额：</div>
															<div class="w100p">{{fee.feeInfo.assistDiscount}}</div>
														</div>
													</td>
												</tr>
												<tr nz-tbody-tr>
													<td colspan="5">
														<div class="flex">
															<div class="flex-1 text-right">应收费用：</div>
															<div class="w100p">{{fee.feeInfo.assistFee}}</div>
														</div>
													</td>
												</tr>
											</ng-container>
										</ng-container>
									</tbody>
								</nz-table>
							</div>
						</div>
						<div *ngIf="fee.feeInfo.checkFeeList.length" class="section">
							<div class="title">检查项目费用</div>
							<div class="pad10">
								<nz-table #nzTable [nzDataSource]="fee.feeInfo.checkFeeList" [nzBordered]="true" [nzIsPagination]="false">
									<thead nz-thead>
										<tr>
											<th>检查</th>
											<th>总价</th>
											<th class="width-lg">备注</th>
											<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
												<th>折扣</th>
												<th>折后金额</th>
											</ng-container>
											<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
												<th>金额</th>
											</ng-container>
										</tr>
									</thead>
									<tbody nz-tbody>
										<tr nz-tbody-tr *ngFor="let check of fee.feeInfo.checkFeeList; let index=index;">
											<td>{{check.projectName}}</td>
											<td>{{check.originalFee}}</td>
											<td>
												<div class="text-lg">{{check.remark}}</div>
											</td>
											<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
												<td>
													<span *ngIf="editMemberType != 'update'">{{check.checkDiscount}}%</span>
													<div *ngIf="editMemberType == 'update'" class="flex">
														<nz-input-number [nzMin]="0" [nzMax]="100" [nzStep]="1" [(ngModel)]="check.checkDiscount"
														(nzBlur)="changeDiscount(check.checkDiscount, check.projectName)"></nz-input-number>
														<div class="pt5">%</div>
													</div>
												</td>
												<td>{{check.checkFee}}</td>
											</ng-container>
											<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
												<td>{{check.checkFee}}</td>
											</ng-container>
										</tr>
										<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
											<tr nz-tbody-tr>
												<td colspan="5">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.checkOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<ng-container *ngIf="fee.feeInfo.checkOriginalFee != fee.feeInfo.checkDiscount">
												<tr nz-tbody-tr>
													<td colspan="5">
														<div class="flex">
															<div class="flex-1 text-right">折扣金额：</div>
															<div class="w100p">{{fee.feeInfo.checkDiscount}}</div>
														</div>
													</td>
												</tr>
												<tr nz-tbody-tr>
													<td colspan="5">
														<div class="flex">
															<div class="flex-1 text-right">应收费用：</div>
															<div class="w100p">{{fee.feeInfo.checkFee}}</div>
														</div>
													</td>
												</tr>
											</ng-container>
										</ng-container>
										<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
											<tr nz-tbody-tr>
												<td colspan="4">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.checkOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<ng-container *ngIf="fee.feeInfo.checkOriginalFee != fee.feeInfo.checkDiscount">
												<tr nz-tbody-tr>
													<td colspan="4">
														<div class="flex">
															<div class="flex-1 text-right">应收费用：</div>
															<div class="w100p">{{fee.feeInfo.checkFee}}</div>
														</div>
													</td>
												</tr>
											</ng-container>
										</ng-container>
										<ng-container *ngIf="dataCode == '0'">
											<tr nz-tbody-tr>
												<td colspan="3">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.checkOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<ng-container *ngIf="fee.feeInfo.checkOriginalFee != fee.feeInfo.checkDiscount">
												<tr nz-tbody-tr>
													<td colspan="3">
														<div class="flex">
															<div class="flex-1 text-right">折扣金额：</div>
															<div class="w100p">{{fee.feeInfo.checkDiscount}}</div>
														</div>
													</td>
												</tr>
												<tr nz-tbody-tr>
													<td colspan="3">
														<div class="flex">
															<div class="flex-1 text-right">应收费用：</div>
															<div class="w100p">{{fee.feeInfo.checkFee}}</div>
														</div>
													</td>
												</tr>
											</ng-container>
										</ng-container>
									</tbody>
								</nz-table>
							</div>
						</div>
						<div *ngIf="fee.feeInfo.medicalFeeList.length > 0" class="section">
							<div class="title">西/中成药费用</div>
							<div class="pad10">
								<nz-table #nzTable [nzDataSource]="fee.feeInfo.medicalFeeList" [nzBordered]="true" [nzIsPagination]="false">
									<thead nz-thead>
										<tr>
											<th>药品</th>
											<th>单价</th>
											<th>总量</th>
											<th>总价</th>
											<th class="width-lg">备注</th>
											<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
												<th>折扣</th>
												<th>折后金额</th>
											</ng-container>
											<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
												<th>金额</th>
											</ng-container>
										</tr>
									</thead>
									<tbody nz-tbody>
										<ng-container *ngFor="let medical of fee.feeInfo.medicalFeeList; let index=index;">
											<tr nz-tbody-tr *ngFor="let info of medical.info">
												<td>{{info.pname}}</td>
												<td>{{info.price}}</td>
												<td>{{info.num}}</td>
												<td>{{info.fee}}</td>
												<td>
													<div class="text-lg">{{info.remark}}</div>
												</td>
												<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
													<td>
														<span *ngIf="editMemberType != 'update'">{{info.msDiscount}}%</span>
														<div *ngIf="editMemberType == 'update'" class="flex">
															<nz-input-number [nzMin]="0" [nzMax]="100" [nzStep]="1" [(ngModel)]="info.msDiscount"
															(nzBlur)="changeDiscount(info.msDiscount, info.pname)"></nz-input-number>
															<div class="pt5">%</div>
														</div>
													</td>
													<td>{{info.msFee}}</td>
												</ng-container>
												<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
													<td>{{info.msFee}}</td>
												</ng-container>
											</tr>
										</ng-container>
										<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
											<tr nz-tbody-tr>
												<td colspan="7">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.medicalOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<ng-container *ngIf="fee.feeInfo.medicalOriginalFee != fee.feeInfo.medicalDiscount">
												<tr nz-tbody-tr>
													<td colspan="7">
														<div class="flex">
															<div class="flex-1 text-right">折扣金额：</div>
															<div class="w100p">{{fee.feeInfo.medicalDiscount}}</div>
														</div>
													</td>
												</tr>
												<tr nz-tbody-tr>
													<td colspan="7">
														<div class="flex">
															<div class="flex-1 text-right">应收费用：</div>
															<div class="w100p">{{fee.feeInfo.medicalFee}}</div>
														</div>
													</td>
												</tr>
											</ng-container>
										</ng-container>
										<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
											<tr nz-tbody-tr>
												<td colspan="6">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.medicalOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<ng-container *ngIf="fee.feeInfo.medicalOriginalFee != fee.feeInfo.medicalDiscount">
												<tr nz-tbody-tr>
													<td colspan="6">
														<div class="flex">
															<div class="flex-1 text-right">应收费用：</div>
															<div class="w100p">{{fee.feeInfo.medicalFee}}</div>
														</div>
													</td>
												</tr>
											</ng-container>
										</ng-container>
										<ng-container *ngIf="dataCode == '0'">
											<tr nz-tbody-tr>
												<td colspan="5">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.medicalOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<ng-container *ngIf="fee.feeInfo.medicalOriginalFee != fee.feeInfo.medicalDiscount">
												<tr nz-tbody-tr>
													<td colspan="5">
														<div class="flex">
															<div class="flex-1 text-right">折扣金额：</div>
															<div class="w100p">{{fee.feeInfo.medicalDiscount}}</div>
														</div>
													</td>
												</tr>
												<tr nz-tbody-tr>
													<td colspan="5">
														<div class="flex">
															<div class="flex-1 text-right">应收费用：</div>
															<div class="w100p">{{fee.feeInfo.medicalFee}}</div>
														</div>
													</td>
												</tr>
											</ng-container>
										</ng-container>
									</tbody>
								</nz-table>
							</div>
						</div>
						<div *ngIf="fee.feeInfo.tcmFeeList.length" class="section">
							<div class="title">中药药方费用</div>
							<div class="pad10">
								<nz-table #nzTable [nzDataSource]="fee.feeInfo.tcmFeeList" [nzBordered]="true" [nzIsPagination]="false">
									<thead nz-thead>
										<tr>
											<th>检查</th>
											<th>总价</th>
											<th class="width-lg">备注</th>
											<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
												<th>折扣</th>
												<th>折后金额</th>
											</ng-container>
											<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
												<th>金额</th>
											</ng-container>
										</tr>
									</thead>
									<tbody nz-tbody>
										<tr nz-tbody-tr *ngFor="let tcm of fee.feeInfo.tcmFeeList; let index=index;">
											<td>{{tcm.projectName}}</td>
											<td>{{tcm.originalFee}}</td>
											<td>
												<div class="text-lg">{{tcm.remark}}</div>
											</td>
											<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
												<td>
													<span *ngIf="editMemberType != 'update'">{{tcm.tcmDiscount}}%</span>
													<div *ngIf="editMemberType == 'update'" class="flex">
														<nz-input-number [nzMin]="0" [nzMax]="100" [nzStep]="1" [(ngModel)]="tcm.tcmDiscount"
														(nzBlur)="changeDiscount(tcm.tcmDiscount, tcm.projectName)"></nz-input-number>
														<div class="pt5">%</div>
													</div>
												</td>
												<td>{{tcm.tcmFee}}</td>
											</ng-container>
											<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
												<td>{{tcm.tcmFee}}</td>
											</ng-container>
										</tr>
										<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
											<tr nz-tbody-tr>
												<td colspan="5">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.tcmOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<ng-container *ngIf="fee.feeInfo.tcmOriginalFee != fee.feeInfo.tcmDiscount">
												<tr nz-tbody-tr>
													<td colspan="5">
														<div class="flex">
															<div class="flex-1 text-right">折扣金额：</div>
															<div class="w100p">{{fee.feeInfo.tcmDiscount}}</div>
														</div>
													</td>
												</tr>
												<tr nz-tbody-tr>
													<td colspan="5">
														<div class="flex">
															<div class="flex-1 text-right">应收费用：</div>
															<div class="w100p">{{fee.feeInfo.tcmFee}}</div>
														</div>
													</td>
												</tr>
											</ng-container>
										</ng-container>
										<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
											<tr nz-tbody-tr>
												<td colspan="4">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.tcmOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<ng-container *ngIf="fee.feeInfo.tcmOriginalFee != fee.feeInfo.tcmDiscount">
												<tr nz-tbody-tr>
													<td colspan="4">
														<div class="flex">
															<div class="flex-1 text-right">应收费用：</div>
															<div class="w100p">{{fee.feeInfo.tcmFee}}</div>
														</div>
													</td>
												</tr>
											</ng-container>
										</ng-container>
										<ng-container *ngIf="dataCode == '0'">
											<tr nz-tbody-tr>
												<td colspan="3">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.tcmOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<ng-container *ngIf="fee.feeInfo.tcmOriginalFee != fee.feeInfo.tcmDiscount">
												<tr nz-tbody-tr>
													<td colspan="3">
														<div class="flex">
															<div class="flex-1 text-right">折扣金额：</div>
															<div class="w100p">{{fee.feeInfo.tcmDiscount}}</div>
														</div>
													</td>
												</tr>
												<tr nz-tbody-tr>
													<td colspan="3">
														<div class="flex">
															<div class="flex-1 text-right">应收费用：</div>
															<div class="w100p">{{fee.feeInfo.tcmFee}}</div>
														</div>
													</td>
												</tr>
											</ng-container>
										</ng-container>
									</tbody>
								</nz-table>
							</div>
						</div>
						<div *ngIf="fee.feeInfo.otherFeeList.length > 0" class="section">
							<div class="title">其他费用</div>
							<div class="pad10">
								<nz-table #nzTable [nzDataSource]="fee.feeInfo.otherFeeList" [nzBordered]="true" [nzIsPagination]="false">
									<thead nz-thead>
										<tr>
											<th>消费项目</th>
											<th>单价</th>
											<th>数量</th>
											<th>总价</th>
											<th class="width-lg">备注</th>
											<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
												<th>折扣</th>
												<th>折后金额</th>
											</ng-container>
											<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
												<th>金额</th>
											</ng-container>
										</tr>
									</thead>
									<tbody nz-tbody>
										<tr nz-tbody-tr *ngFor="let other of fee.feeInfo.otherFeeList; let index=index;">
											<td>{{other.projectName}}</td>
											<td>{{other.price}}</td>
											<td>{{other.number}}</td>
											<td>{{other.originalFee}}</td>
											<td>
												<div class="text-lg">{{other.remark}}</div>
											</td>
											<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
												<td>
													<span *ngIf="editMemberType != 'update'">{{other.otherDiscount}}%</span>
													<div *ngIf="editMemberType == 'update'" class="flex">
														<nz-input-number [nzMin]="0" [nzMax]="100" [nzStep]="1" [(ngModel)]="other.otherDiscount"
														(nzBlur)="changeDiscount(other.otherDiscount, other.projectName)"></nz-input-number>
														<div class="pt5">%</div>
													</div>
												</td>
												<td>{{other.otherFee}}</td>
											</ng-container>
											<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
												<td>{{other.otherFee}}</td>
											</ng-container>
										</tr>
										<ng-container *ngIf="dataCode == '1' && paymentType == '30'">
											<tr nz-tbody-tr>
												<td colspan="7">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.otherOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<ng-container *ngIf="fee.feeInfo.otherOriginalFee != fee.feeInfo.otherDiscount">
												<tr nz-tbody-tr>
													<td colspan="7">
														<div class="flex">
															<div class="flex-1 text-right">折扣金额：</div>
															<div class="w100p">{{fee.feeInfo.otherDiscount}}</div>
														</div>
													</td>
												</tr>
												<tr nz-tbody-tr>
													<td colspan="7">
														<div class="flex">
															<div class="flex-1 text-right">应收费用：</div>
															<div class="w100p">{{fee.feeInfo.otherFee}}</div>
														</div>
													</td>
												</tr>
											</ng-container>
										</ng-container>
										<ng-container *ngIf="(dataCode == '1' && paymentType == '40') || dataCode == '2'">
											<tr nz-tbody-tr>
												<td colspan="6">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.otherOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<ng-container *ngIf="fee.feeInfo.otherOriginalFee != fee.feeInfo.otherDiscount">
												<tr nz-tbody-tr>
													<td colspan="6">
														<div class="flex">
															<div class="flex-1 text-right">应收费用：</div>
															<div class="w100p">{{fee.feeInfo.otherFee}}</div>
														</div>
													</td>
												</tr>
											</ng-container>
										</ng-container>
										<ng-container *ngIf="dataCode == '0'">
											<tr nz-tbody-tr>
												<td colspan="5">
													<div class="flex">
														<div class="flex-1 text-right">费用合计：</div>
														<div class="w100p">{{fee.feeInfo.otherOriginalFee}}</div>
													</div>
												</td>
											</tr>
											<ng-container *ngIf="fee.feeInfo.otherOriginalFee != fee.feeInfo.otherDiscount">
												<tr nz-tbody-tr>
													<td colspan="5">
														<div class="flex">
															<div class="flex-1 text-right">折扣金额：</div>
															<div class="w100p">{{fee.feeInfo.otherDiscount}}</div>
														</div>
													</td>
												</tr>
												<tr nz-tbody-tr>
													<td colspan="5">
														<div class="flex">
															<div class="flex-1 text-right">应收费用：</div>
															<div class="w100p">{{fee.feeInfo.otherFee}}</div>
														</div>
													</td>
												</tr>
											</ng-container>
										</ng-container>
									</tbody>
								</nz-table>
							</div>
						</div>
						<div class="section">
							<div class="title flex">
								<div class="flex-1 text-right">费用合计：</div>
								<div class="w100p">{{fee.originalCost}}</div>
							</div>
						</div>
						<div class="section">
							<div class="title flex">
								<div class="flex-1 text-right">应收费用：</div>
								<div class="w100p">{{fee.fee}}</div>
							</div>
						</div>
						<!-- 选择活动卡后的费用信息 -->
						<div *ngIf="userInfo.selectedActcard.service.length > 0">
							<div class="section" *ngFor="let actService of userInfo.selectedActcard.service">
								<div class="title flex">
									<div class="flex-1 text-right">{{actService.pay_text}}：</div>
									<div class="w100p">-{{actService.pay_money}}</div>
								</div>
							</div>
							<div class="section">
								<div class="title flex">
									<div class="flex-1 text-right">仍需费用：</div>
									<div class="w100p">{{fee.stillNeedFee}}</div>
								</div>
							</div>
						</div>
						<div *ngIf="bookingInfo.status != '5'">
							<div *ngIf="userInfo.actCards.length > 0" class="section">
								<div class="title">活动卡</div>
								<div class="pad10">
									<div nz-row [nzGutter]="30" class="actcard-list">
										<div nz-col [nzSpan]="6" *ngFor="let actcard of userInfo.actCards">
											<nz-badge [nzCount]="actcard.num" class="w100 item" (click)="selectActcard(actcard)" [ngClass]="{'disabled': actcard.disabled == 1, 'canUse': actcard.disabled != 1 && actcard.selected != 1, 'selected': actcard.selected == 1}">
										        <ng-template #content>
													<div class="info">{{actcard.activityName}}</div>
													<div class="useInfo">可用于：{{actcard.projectName}}</div>
										        </ng-template>
										    </nz-badge>
										</div>
									</div>
								</div>
							</div>
							<div class="section">
								<div class="title">他人活动卡</div>
								<div class="pad10">
									<div nz-form-item nz-row>
						            	<div nz-form-label nz-col [nzSpan]="9" class="text-right">
						              		<label for="other_user">家长姓名：</label>
						            	</div>
						            	<div nz-form-control nz-col [nzSpan]="15">
											<nz-select
												class="w100"
												nzAllowClear
												[nzSize]="'large'"
												[nzPlaceHolder]="'请选择家长'"
												[ngModel]="selectedInfo.user"
												(ngModelChange)="selectedOtherUser($event)"
												nzShowSearch>
												<nz-option
													*ngFor="let user of selectedInfo.userList"
													[nzLabel]="user.name"
													[nzValue]="user">
												</nz-option>
											</nz-select>
						            	</div>
						          	</div>
									<div *ngIf="selectedInfo.user != null && selectedInfo.user.actCards && selectedInfo.user.actCards.length > 0" nz-row [nzGutter]="30" class="actcard-list mt10">
										<div nz-col [nzSpan]="6" *ngFor="let actcard of selectedInfo.user.actCards">
											<nz-badge [nzCount]="actcard.num" class="w100 item" (click)="selectActcard(actcard)" [ngClass]="{'disabled': actcard.disabled == 1, 'canUse': actcard.disabled != 1 && actcard.selected != 1, 'selected': actcard.selected == 1}">
										        <ng-template #content>
													<div class="info">{{actcard.activityName}}</div>
													<div class="useInfo">可用于：{{actcard.projectName}}</div>
										        </ng-template>
										    </nz-badge>
										</div>
									</div>
									<div *ngIf="selectedInfo.user != null && selectedInfo.user.actCards && selectedInfo.user.actCards.length == 0">
										暂无活动卡
									</div>
								</div>
							</div>
						</div>
					</div>
				</ng-template>
			</nz-card>
			<nz-card class="mt20" *ngIf="bookingInfo.status == '5'">
                <ng-template #title>
                    支付详情
                </ng-template>
                <ng-template #body>
					<div>
						<div class="section">
							<div class="title">减免金额：{{fee.tranInfo.giveAmount}}</div>
						</div>
						<div class="section" *ngIf="fee.tranInfo.payWay != null">
							<div class="title">{{fee.tranInfo.wayText}}：{{fee.tranInfo.amount}}</div>
						</div>
						<div class="section" *ngIf="fee.tranInfo.secondWay != null">
							<div class="title">{{fee.tranInfo.secondWayText}}：{{fee.tranInfo.secondAmount}}</div>
						</div>
						<div class="section">
							<div class="title">
								备注：{{fee.remark}}
							</div>
						</div>
					</div>
				</ng-template>
			</nz-card>
			<div class="mt20 text-right">
				<button *ngIf="bookingInfo.status == '5'" nz-button [nzType]="'default'" [nzSize]="'large'">订单已完成</button>
				<button *ngIf="bookingInfo.status != '5' && fee.canPay == '1'" (click)="getPrescript()" nz-button [nzType]="'primary'" [nzSize]="'large'">支付</button>
				<button *ngIf="bookingInfo.status != '5' && fee.canPay == '0'" nz-button [nzType]="'default'" [nzSize]="'large'">操作未完成，不能完成支付(退药操作未完成)</button>
			</div>
		</div>
	</div>
</div>
<div class="modal" *ngIf="modalTab">
	<div class="modal-mask" (click)="close()"></div>
	<div class="container">
		<div class="title">支付</div>
		<div class="content pad10 pure-form form-tab">
			<div class="flex">
				<div class="pure-control-group flex-1 flex">
					<label for="user" class="w150p mr20 text-right">用户：</label>
					<label class="flex-1">{{bookingInfo.creatorName}}</label>
				</div>
				<div class="pure-control-group flex-1 flex">
					<label for="member" class="w150p mr20 text-right">余额：</label>
					<label>{{userInfo.member.userBalance}}</label>
					<div *ngIf="moduleAuthority.recharge" class="flex-1 ml20">
						<button (click)="recharge()" nz-button [nzType]="'primary'" [nzSize]="'large'">充值</button>
					</div>
				</div>
				<div class="pure-control-group flex-1 flex">
					<label for="fee" class="w150p mr20 text-right">消费金额：</label>
					<label class="flex-1">{{fee.fee}}</label>
				</div>
			</div>
			<div class="pure-control-group flex mt10">
				<label for="give_amount" class="w150p mr20 text-right">减免金额：</label>
				<input type="number" id="give_amount" name="give_amount" step="0.01" [(ngModel)]="payInfo.give_amount" (keyup)="changeMoney('give_amount')" placeholder="请输入减免金额" class="flex-1">
			</div>
			<div class="pure-control-group flex mt10">
				<label for="pay_way" class="w150p mr20 text-right">
					<span>支付方式</span>
					<span class="required">*</span>：
				</label>
				<div class="flex-1">
					<div class="flex flex-wrap pay-list">
						<!-- <div
								*ngIf="userInfo.member.selectedMemberJson.memberId"
							class="item"
							(click)="changePayway(userInfo.member.selectedMemberJson, userInfo.member.selectedMemberJson.use)"
							[ngClass]="{'disabled': !payInfo.memberBalance || !userInfo.member.selectedMemberJson.use, 'active': payInfo.payway.way == 'member_' + userInfo.member.selectedMemberJson.umId || payInfo.payway_second.way == 'member_' + userInfo.member.selectedMemberJson.umId}"
							>{{userInfo.member.selectedMemberJson.memberName}}{{userInfo.member.selectedMemberJson.balance ? '' : '（余额不足）'}}</div> -->
						<ng-container *ngFor="let payway of paywayList">
							<div
								class="item"
								(click)="changePayway(payway, (payway.key == 'member' ? payInfo.memberBalance : true) && payway.use)"
								[ngClass]="{'disabled': payway.key == 'member' && !payInfo.memberBalance || !payway.use, 'active': payInfo.payway.way == payway.key || payInfo.payway_second.way == payway.key}"
								>{{payway.value}}{{payway.key == 'member' ? (payInfo.memberBalance ? '' : '（余额不足）') : ''}}
							</div>
						</ng-container>
					</div>
				</div>
			</div>
			<div *ngIf="payInfo.payway.way != ''" class="pure-control-group flex">
				<label for="user" class="w150p mr20 text-right">{{payInfo.payway.text}}：</label>
				<div class="flex-1">
					<input type="number" step="0.01" [(ngModel)]="payInfo.payway.money" (keyup)="changeMoney('payway')" placeholder="请输入{{payInfo.payway.text}}金额" [disabled]="payInfo.payway.way == 'activity'">
				</div>
			</div>
			<div *ngIf="payInfo.payway_second.way != ''" class="pure-control-group flex">
				<label for="user" class="w150p mr20 text-right">{{payInfo.payway_second.text}}：</label>
				<div class="flex-1">
					<input type="number" step="0.01" [(ngModel)]="payInfo.payway_second.money" (keyup)="changeMoney('payway_second')" placeholder="请输入{{payInfo.payway_second.text}}金额" [disabled]="payInfo.payway_second.way == 'activity'">
				</div>
			</div>
			<div class="pure-control-group flex mt10">
				<label for="remark" class="w150p mr20 text-right">备注：</label>
				<textarea id="remark" name="remark" rows="2" maxlength="200" [(ngModel)]="payInfo.remark" placeholder="请输入备注" class="flex-1 auto"></textarea>
			</div>
			<div class="pure-control-group flex">
				<label for="user" class="w150p mr20 text-right">还需支付：</label>
				<label class="flex-1">{{payInfo.stillNeedPay}}</label>
			</div>
		</div>
		<div class="button-tab pad10 text-right">
			<button (click)="close()" nz-button [nzType]="'default'" [nzSize]="'large'">取消</button>
			<button (click)="confirmPay()" nz-button [nzType]="'primary'" [nzSize]="'large'" [disabled]="btnCanEdit || payInfo.stillNeedPay != '0.00'">确认支付</button>
		</div>
	</div>
</div>
<div class="modal" *ngIf="modalTabAddPay">
	<div class="modal-mask" (click)="closeAddPay()"></div>
	<div class="container">
		<div class="title">支付</div>
		<div class="content pad10 pure-form form-tab">
			<div class="flex">
				<div class="pure-control-group flex-1 flex">
					<label for="user" class="w150p mr20 text-right">用户：</label>
					<label class="flex-1">{{bookingInfo.creatorName}}</label>
				</div>
				<div class="pure-control-group flex-1 flex">
					<label for="member" class="w150p mr20 text-right">余额：</label>
					<label>{{userInfo.member.userBalance}}</label>
					<div *ngIf="moduleAuthority.recharge" class="flex-1 ml20">
						<button (click)="recharge()" nz-button [nzType]="'primary'" [nzSize]="'large'">充值</button>
					</div>
				</div>
				<div class="pure-control-group flex-1 flex">
					<label for="fee" class="w150p mr20 text-right">消费金额：</label>
					<label class="flex-1">{{fee.fee}}</label>
				</div>
			</div>
			<div class="pure-control-group flex mt10">
				<label for="pay_way" class="w150p mr20 text-right">
					<span>支付方式</span>
					<span class="required">*</span>：
				</label>
				<div class="flex-1">
					<div class="flex flex-wrap pay-list">
						<!-- <div
							*ngIf="userInfo.member.selectedMemberJson.memberId"
							class="item"
							(click)="changeAddPayway(userInfo.member.selectedMemberJson, userInfo.member.selectedMemberJson.use)"
							[ngClass]="{'disabled': !payInfo.memberBalance || !userInfo.member.selectedMemberJson.use, 'active': payInfo.payway.way == 'member_' + userInfo.member.selectedMemberJson.umId || payInfo.payway_second.way == 'member_' + userInfo.member.selectedMemberJson.umId}"
							>{{userInfo.member.selectedMemberJson.memberName}}{{userInfo.member.selectedMemberJson.balance ? '' : '（余额不足）'}}</div> -->
						<ng-container *ngFor="let payway of paywayList">
							<div
								*ngIf="payway.key != 'member'"
								class="item"
								(click)="changeAddPayway(payway, (payway.key == 'member' ? payInfo.memberBalance : true) && payway.use)"
								[ngClass]="{'disabled': payway.key == 'member' && !payInfo.memberBalance || !payway.use, 'active': payInfo.payway.way == payway.key || payInfo.payway_second.way == payway.key}"
								>{{payway.value}}{{payway.key == 'member' ? (payInfo.memberBalance ? '' : '（余额不足）') : ''}}
							</div>
						</ng-container>
					</div>
				</div>
			</div>
			<div *ngIf="payInfo.payway_second.way != ''" class="pure-control-group flex">
				<label for="user" class="w150p mr20 text-right">{{payInfo.payway_second.text}}：</label>
				<div class="flex-1">
					<input type="number" step="0.01" [(ngModel)]="payInfo.payway_second.money" (keyup)="changeMoney('payway_second')" placeholder="请输入{{payInfo.payway_second.text}}金额">
				</div>
			</div>
			<div class="pure-control-group flex">
				<label for="user" class="w150p mr20 text-right">还需支付：</label>
				<label class="flex-1">{{payInfo.stillNeedPay}}</label>
			</div>
		</div>
		<div class="button-tab pad10 text-right">
			<button (click)="closeAddPay()" nz-button [nzType]="'default'" [nzSize]="'large'">取消</button>
			<button (click)="confirmAddPay()" nz-button [nzType]="'primary'" [nzSize]="'large'" [disabled]="btnCanEdit || payInfo.stillNeedPay != '0.00'">确认支付</button>
		</div>
	</div>
</div>
<div class="modal" *ngIf="confirmTab.show">
	<div class="modal-mask" (click)="closeConfirmTab()"></div>
	<div class="container">
		<div class="title">提示</div>
		<div class="content pad10">
			{{confirmTab.text}}
		</div>
		<div class="button-tab pad10 text-right">
			<button (click)="goConfirm()" nz-button [nzType]="'primary'" [nzSize]="'large'">{{confirmTab.buttonText}}</button>
		</div>
	</div>
</div>
<loading [show]="loadingShow"></loading>
